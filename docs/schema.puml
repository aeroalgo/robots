@startuml
skinparam packageStyle rectangle
skinparam shadowing false

package "Application Layer" {
  class IndicatorService {
    +run_supertrend(symbol, timeframe, start, end)
  }
}

package "Data Access Layer" {
  class ClickHouseConnector {
    +get_ohlcv(symbol, timeframe, start, end, limit) : Vec<OhlcvData>
  }
  class OhlcvData
}

package "Data Model Layer" {
  class Symbol
  class TimeFrame
  class Quote {
    +from(OhlcvData) : Quote
  }
  class QuoteFrame {
    +try_from_ohlcv(data, symbol, timeframe) : Result<QuoteFrame>
    +closes() : ValueVector
  }
  class ValueVector
}

package "Indicator Layer" {
  class SuperTrendIndicator {
    +calculate(frame: QuoteFrame) : IndicatorOutput
  }
  class IndicatorOutput
}

package "Strategy Layer" {
  class StrategyEngine
}

ClickHouseConnector --> OhlcvData : fetch
OhlcvData --> Quote : convert
Quote --> QuoteFrame : build
QuoteFrame --> ValueVector : extract series
QuoteFrame --> SuperTrendIndicator : compute
SuperTrendIndicator --> IndicatorOutput : result

IndicatorService --> ClickHouseConnector : get_ohlcv()
IndicatorService --> QuoteFrame : assemble()
IndicatorService --> SuperTrendIndicator : calculate()
StrategyEngine --> SuperTrendIndicator : use results (например, фильтры)
@enduml