# –ê–Ω–∞–ª–∏–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–æ–¥—É–ª—è candles

**–î–∞—Ç–∞**: 2025-01-27
**–ú–æ–¥—É–ª—å**: `src/candles/`
**–§–∞–π–ª—ã**: `mod.rs`, `aggregator.rs`, `bar_types.rs`, `builders.rs`

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã

#### ‚úÖ Single Responsibility Principle (SRP)
- **–•–æ—Ä–æ—à–æ**: –ö–∞–∂–¥—ã–π builder –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ–π —Ç–∏–ø –±–∞—Ä–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞**: `TimeFrameAggregator` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
  - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—Ä–µ–π–º–æ–≤
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
  - –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
  - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–∏–Ω—É—Ç –≤ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã

#### ‚úÖ Open/Closed Principle (OCP)
- **–•–æ—Ä–æ—à–æ**: Trait `BarBuilder` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–ü—Ä–æ–±–ª–µ–º–∞**: `BarBuilderFactory` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç match –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–ª–¥–µ—Ä–æ–≤ - –Ω–∞—Ä—É—à–µ–Ω–∏–µ OCP

#### ‚úÖ Liskov Substitution Principle (LSP)
- **–•–æ—Ä–æ—à–æ**: –í—Å–µ builders –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑—É—é—Ç `BarBuilder`

#### ‚úÖ Interface Segregation Principle (ISP)
- **–•–æ—Ä–æ—à–æ**: Trait `BarBuilder` –º–∏–Ω–∏–º–∞–ª–µ–Ω –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω

#### ‚úÖ Dependency Inversion Principle (DIP)
- **–•–æ—Ä–æ—à–æ**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (`BarBuilder` trait)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ (`Quote`, `QuoteFrame`)

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### ‚úÖ Factory Pattern
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `BarBuilderFactory`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç match –≤–º–µ—Å—Ç–æ registry pattern

#### ‚ùå Strategy Pattern
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

#### ‚ùå Builder Pattern
- **–ü—Ä–æ–±–ª–µ–º–∞**: Builders –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç fluent interface

### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å

#### ‚úÖ –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏: `bar_types`, `builders`, `aggregator`
- **–ü—Ä–æ–±–ª–µ–º–∞**: `aggregator.rs` —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (535 —Å—Ç—Ä–æ–∫)

#### ‚ö†Ô∏è –°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å
- –í—ã—Å–æ–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å —Å `QuoteFrame` –∏ `Quote`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

#### ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `data_model` –±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

## üìù –ö–ê–ß–ï–°–¢–í–û –ö–û–î–ê

### –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

#### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **–î–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
   - `TimeFrameAggregator::aggregate()` - 98 —Å—Ç—Ä–æ–∫
   - `TimeFrameAggregator::expand()` - 140 —Å—Ç—Ä–æ–∫
   - `TimeFrameAggregator::build_compressed_frame_from_source()` - 106 —Å—Ç—Ä–æ–∫
   - `RangeBarBuilder::build_from_quotes()` - 60 —Å—Ç—Ä–æ–∫

2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**:
   - –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è `Quote::from_parts()` –≤ builders
   - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –≤ aggregator
   - –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è high/low –≤ builders

3. **–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞**:
   - `ratio as usize` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
   - –•–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–π –≤ `minutes_to_timeframe()`

4. **–°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è**:
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ if –≤ `expand()`
   - –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `build_compressed_frame_from_source()`

### –°–ª–æ–∂–Ω–æ—Å—Ç—å (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è)

#### ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
- `TimeFrameAggregator::expand()` - —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å ~15
- `TimeFrameAggregator::build_compressed_frame_from_source()` - —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å ~12
- `RangeBarBuilder::build_from_quotes()` - —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å ~8

### DRY –ø—Ä–∏–Ω—Ü–∏–ø

#### ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏—è
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è Quote**:
   - –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º builder
   - –ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ helper —Ñ—É–Ω–∫—Ü–∏—é

2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è high/low**:
   - –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ `RangeBarBuilder`, `VolumeBarBuilder`, `VolatilityBarBuilder`

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏**:
   - –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `is_valid_aggregation()` –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Result` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ (`BarBuilderError`, `TimeFrameAggregationError`)

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **–ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–æ–∫**:
   - `TimeFrameAggregationError::UnsupportedTimeFrame` —Ç–µ—Ä—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º
   - –ù–µ—Ç —Ü–µ–ø–æ—á–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

2. **–ù–µ–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - `build_compressed_frame_from_source()` –º–æ–∂–µ—Ç –ø–∞–Ω–∏–∫–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ `ratio as usize`

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ `QuoteFrame`
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## ‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

#### ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- –õ–∏–Ω–µ–π–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å O(n) –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
   - `expand()` —Å–æ–∑–¥–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤
   - `get_source_quotes()` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π `Vec` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è `Symbol` –∏ `TimeFrame`

2. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏**:
   - `build_compressed_frame_from_source()` –∏–º–µ–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã
   - –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏**:
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è `Quote` –≤ builders
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ `expand()`
   - –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `Symbol` –∏ `TimeFrame` –≤ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö**:
   - `HashMap<usize, Vec<usize>>` –¥–ª—è `source_indices` –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `Vec<Vec<usize>>`
   - `Option<Quote>` –≤ builders —Å–æ–∑–¥–∞–µ—Ç overhead

### –ê–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç—è—Ö

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–í —Ü–∏–∫–ª–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏**:
   - –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `Quote` –≤ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö `Quote` –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–í expand()**:
   - –°–æ–∑–¥–∞–Ω–∏–µ `Vec<&Quote>` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±–∞—Ä–∞
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### üî¥ Critical
1. –£–±—Ä–∞—Ç—å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç—è—Ö
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Vec` –≤–º–µ—Å—Ç–æ `HashMap` –¥–ª—è `source_indices`
3. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –ø–∞–º—è—Ç—å –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### üü† High
1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ `timeframe_to_minutes()`
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `align_to_timeframe()`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

## ü¶Ä RUST-–°–ü–ï–¶–ò–§–ò–ö–ê

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤–ª–∞–¥–µ–Ω–∏—è –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è

#### ‚úÖ –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –∏ –≤–ª–∞–¥–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `&Quote` –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**:
   - `symbol.clone()` –≤ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
   - `timeframe.clone()` –≤ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
   - `quote.clone()` –≤ builders

2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ**:
   - `AggregatedQuoteFrame` –≤–ª–∞–¥–µ–µ—Ç `QuoteFrame`, –Ω–æ —Ç–∞–∫–∂–µ —Ö—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ `source_indices`

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∞–º–∏ –∂–∏–∑–Ω–∏

#### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ lifetime annotations –≤ `get_source_quotes()`

#### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- –°–ª–æ–∂–Ω—ã–µ lifetime –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `expand()`

### –î–∏–∑–∞–π–Ω —Ç—Ä–µ–π—Ç–æ–≤

#### ‚úÖ –•–æ—Ä–æ—à–∏–π –¥–∏–∑–∞–π–Ω
- Trait `BarBuilder` —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤**:
   - –ù–µ—Ç helper –º–µ—Ç–æ–¥–æ–≤ –≤ trait –¥–ª—è –æ–±—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ö–∞–∂–¥—ã–π builder –¥—É–±–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É

2. **–ù–µ—Ç default implementations**:
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å default –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–±—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### Zero-cost –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

#### ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- Trait `BarBuilder` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ zero-cost –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **Box<dyn BarBuilder>**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ trait objects —Å–æ–∑–¥–∞–µ—Ç overhead
   - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å generics –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏

2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è**:
   - `BarBuilderFactory::create_builder()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Box<dyn BarBuilder>`
   - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enum –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏

## üìä –ö–ê–¢–ï–ì–û–†–ò–ó–ê–¶–ò–Ø –ü–†–û–ë–õ–ï–ú

### üî¥ Critical (–£—è–∑–≤–∏–º–æ—Å—Ç–∏, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤** - –Ω–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏
2. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ** - `ratio as usize` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
3. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç—è—Ö
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### üü† High (–ù–∞—Ä—É—à–µ–Ω–∏—è SOLID, –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ SRP** - `TimeFrameAggregator` –∏–º–µ–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
2. **–í—ã—Å–æ–∫–∞—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** - —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é >10
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - –ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –≤ builders
4. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö** - `HashMap` –≤–º–µ—Å—Ç–æ `Vec` –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
5. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Box<dyn BarBuilder>`

### üü° Medium (–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞, –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã)

1. **–î–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - —Ñ—É–Ω–∫—Ü–∏–∏ >50 —Å—Ç—Ä–æ–∫
2. **–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞** - —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–π
3. **–°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ if
4. **–ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–æ–∫** - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—à–∏–±–∫–∞—Ö
5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ helper –º–µ—Ç–æ–¥–æ–≤** - –Ω–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

### üü¢ Low (–ú–µ–ª–∫–∏–µ —Å—Ç–∏–ª–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - –Ω–µ—Ç rustdoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ const** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å const –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç

## üìà –ú–ï–¢–†–ò–ö–ò

### –†–∞–∑–º–µ—Ä –∫–æ–¥–∞
- `aggregator.rs`: 535 —Å—Ç—Ä–æ–∫
- `builders.rs`: 437 —Å—Ç—Ä–æ–∫
- `bar_types.rs`: 74 —Å—Ç—Ä–æ–∫–∏
- `mod.rs`: 8 —Å—Ç—Ä–æ–∫
- **–í—Å–µ–≥–æ**: 1054 —Å—Ç—Ä–æ–∫–∏

### –°–ª–æ–∂–Ω–æ—Å—Ç—å
- –°—Ä–µ–¥–Ω—è—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: ~8
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: ~15

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- **0%** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –í–Ω–µ—à–Ω–∏–µ: `chrono`, `thiserror`, `serde`
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ: `data_model::quote`, `data_model::quote_frame`, `data_model::types`
