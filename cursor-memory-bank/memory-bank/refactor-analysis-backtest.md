# –ê–Ω–∞–ª–∏–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–æ–¥—É–ª—è Backtest

## –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
2025-01-27

## –û–±–ª–∞—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞
–ú–æ–¥—É–ª—å `src/backtest/` - —Å–∏—Å—Ç–µ–º–∞ –±—ç–∫—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

## –§–ê–ó–ê 1: –ú–ù–û–ì–û–ú–ï–†–ù–´–ô –ê–ù–ê–õ–ò–ó

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã

**üî¥ Critical: –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle (SRP)**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `BacktestEngine` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π:
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ (FeedManager)
  - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (IndicatorEngine)
  - –û—Ü–µ–Ω–∫–∞ —É—Å–ª–æ–≤–∏–π (ConditionEvaluator)
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ (PositionManager)
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏ (RiskManager)
  - –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (BacktestAnalytics)
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ (SessionManager)
  - –†–∞—Å—á–µ—Ç equity (EquityCalculator)
- **–§–∞–π–ª**: `engine.rs:23-37`
- **–í–ª–∏—è–Ω–∏–µ**: –í—ã—Å–æ–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å, —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**üü† High: –ù–∞—Ä—É—à–µ–Ω–∏–µ Open/Closed Principle (OCP)**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ `new_with_provider` —Å–æ–¥–µ—Ä–∂–∏—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
- **–§–∞–π–ª**: `engine.rs:118-161`
- **–í–ª–∏—è–Ω–∏–µ**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞

**üü° Medium: –ù–∞—Ä—É—à–µ–Ω–∏–µ Dependency Inversion Principle (DIP)**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–º–µ—Å—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
- **–§–∞–π–ª**: `engine.rs:23-37`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–º–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**üü† High: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Strategy –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏–π**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `StrategyDecision` –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
- **–§–∞–π–ª**: `engine.rs:445-514`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏–π

**üü° Medium: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Builder –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- **–§–∞–π–ª**: `engine.rs:241-252`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

#### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å

**üü† High: –í—ã—Å–æ–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- **–§–∞–π–ª**: `engine.rs:23-37`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑–æ–ª—è—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**üü° Medium: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —á–µ—Ç–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã –≤–º–µ—Å—Ç–æ —Ç—Ä–µ–π—Ç–æ–≤
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–º–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üìù –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

#### –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

**üü† High: –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `new_with_provider` - 200+ —Å—Ç—Ä–æ–∫, `run_backtest` - 170+ —Å—Ç—Ä–æ–∫
- **–§–∞–π–ª**: `engine.rs:47-239`, `engine.rs:360-530`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**üü° Medium: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
- **–§–∞–π–ª**: `engine.rs:105-115`, `engine.rs:145-158`
- **–í–ª–∏—è–Ω–∏–µ**: –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**üü° Medium: –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
- **–§–∞–π–ª**: `engine.rs:120-128`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏

#### –°–ª–æ–∂–Ω–æ—Å—Ç—å

**üü† High: –í—ã—Å–æ–∫–∞—è —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `run_backtest` –∏–º–µ–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å > 15
- **–§–∞–π–ª**: `engine.rs:360-530`
- **–í–ª–∏—è–Ω–∏–µ**: –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –±–∞–≥–æ–≤, —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**üü° Medium: –í–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ if-else
- **–§–∞–π–ª**: `engine.rs:420-435`, `engine.rs:450-488`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### DRY –ø—Ä–∏–Ω—Ü–∏–ø

**üü° Medium: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- **–§–∞–π–ª**: `engine.rs:109-114`, `engine.rs:152-157`
- **–í–ª–∏—è–Ω–∏–µ**: –†–∏—Å–∫ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**üü¢ Low: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
- **–§–∞–π–ª**: `engine.rs:98-103`, `engine.rs:135-143`
- **–í–ª–∏—è–Ω–∏–µ**: –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**üü† High: –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–º–µ—à–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–§–∞–π–ª**: `engine.rs:493`, `engine.rs:554`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**üü° Medium: –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–æ–∫**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–§–∞–π–ª**: `engine.rs:267`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

**üü† High: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤**
- **–ü—Ä–æ–±–ª–µ–º–∞**: O(n*m) –≥–¥–µ n - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤, m - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö
- **–§–∞–π–ª**: `engine.rs:86-163`
- **–í–ª–∏—è–Ω–∏–µ**: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤

**üü° Medium: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Ü–∏–∫–ª–µ**
- **–ü—Ä–æ–±–ª–µ–º–∞**: `update_trailing_stops` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö
- **–§–∞–π–ª**: `engine.rs:442`, `engine.rs:512`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

**üü° Medium: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ HashMap**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `frames.get()` –≤ —Ü–∏–∫–ª–µ
- **–§–∞–π–ª**: `engine.rs:96-138`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ö–µ—à–µ–π

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**üü† High: –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ `TimeFrame` –≤ —Ü–∏–∫–ª–∞—Ö
- **–§–∞–π–ª**: `engine.rs:80-82`, `engine.rs:97-98`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏

**üü° Medium: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ–∑–¥–∞–Ω–∏–µ `aggregated_frames` –∏ –∑–∞—Ç–µ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `arc_frames`
- **–§–∞–π–ª**: `engine.rs:85-167`
- **–í–ª–∏—è–Ω–∏–µ**: –î–≤–æ–π–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**üü° Medium: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Arc**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ–∑–¥–∞–Ω–∏–µ Arc –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–¥—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **–§–∞–π–ª**: `engine.rs:81`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏

#### –ê–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç—è—Ö

**üü† High: –ê–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ `run_backtest`
- **–§–∞–π–ª**: `engine.rs:461-487`
- **–í–ª–∏—è–Ω–∏–µ**: –°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**üü° Medium: –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–æ–∑–¥–∞–Ω–∏–µ `StrategyDecision::empty()` –≤ —Ü–∏–∫–ª–µ
- **–§–∞–π–ª**: `engine.rs:548`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏

### ü¶Ä Rust-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤–ª–∞–¥–µ–Ω–∏—è –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è

**üü° Medium: –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Arc**
- **–ü—Ä–æ–±–ª–µ–º–∞**: Arc –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–µ–Ω
- **–§–∞–π–ª**: `engine.rs:75-76`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

**üü¢ Low: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç `&mut self` –∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ `&self`
- **–í–ª–∏—è–Ω–∏–µ**: –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∞–º–∏ –∂–∏–∑–Ω–∏

**üü¢ Low: –Ø–≤–Ω—ã–µ lifetime –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —è–≤–Ω—ã—Ö lifetime –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–¥–µ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã
- **–í–ª–∏—è–Ω–∏–µ**: –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –î–∏–∑–∞–π–Ω —Ç—Ä–µ–π—Ç–æ–≤

**üü† High: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–π—Ç–æ–≤ –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç—Ä–µ–π—Ç—ã –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
- **–§–∞–π–ª**: `engine.rs:23-37`
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–º–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**üü° Medium: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±–æ–±—â–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –≤–º–µ—Å—Ç–æ generics
- **–í–ª–∏—è–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

#### Zero-cost –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

**üü° Medium: –ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ zero-cost –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HashMap –≥–¥–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–§–∞–π–ª**: `engine.rs:75-76`
- **–í–ª–∏—è–Ω–∏–µ**: –õ–∏—à–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

## –§–ê–ó–ê 2: –ö–ê–¢–ï–ì–û–†–ò–ó–ê–¶–ò–Ø –ü–†–û–ë–õ–ï–ú

### üî¥ Critical (–£—è–∑–≤–∏–º–æ—Å—Ç–∏, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ SRP –≤ BacktestEngine** - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π
2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤** - O(n*m) —Å–ª–æ–∂–Ω–æ—Å—Ç—å
3. **–ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ TimeFrame** - –ª–∏—à–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏
4. **–ê–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ** - —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üü† High (–ù–∞—Ä—É—à–µ–Ω–∏—è SOLID, –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ OCP** - –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
2. **–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã** - `new_with_provider` –∏ `run_backtest`
3. **–í—ã—Å–æ–∫–∞—è —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** - `run_backtest` > 15
4. **–ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
5. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - `aggregated_frames` –∏ `arc_frames`
6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–π—Ç–æ–≤ –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏**

### üü° Medium (–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞, –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã)
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤**
2. **–ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞** - –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏
3. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è** - —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏—è
4. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Ü–∏–∫–ª–µ**
5. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ HashMap**
6. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Arc**
7. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Strategy –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏–π**
8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Builder –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

### üü¢ Low (–ú–µ–ª–∫–∏–µ —Å—Ç–∏–ª–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–µ–±–æ–ª—å—à–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞–ª–∏—á–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤**
2. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è** - `&mut self` –≤–º–µ—Å—Ç–æ `&self`
3. **–Ø–≤–Ω—ã–µ lifetime –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**
4. **–ù–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ zero-cost –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π**

## –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–¥–∞
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫**: ~800
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤**: 8
- **–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –º–µ—Ç–æ–¥–∞**: ~50 —Å—Ç—Ä–æ–∫
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –º–µ—Ç–æ–¥–∞**: 200+ —Å—Ç—Ä–æ–∫ (`new_with_provider`)
- **–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: 15+ (`run_backtest`)

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- **Critical**: 4 –ø—Ä–æ–±–ª–µ–º—ã
- **High**: 6 –ø—Ä–æ–±–ª–µ–º
- **Medium**: 8 –ø—Ä–æ–±–ª–µ–º
- **Low**: 4 –ø—Ä–æ–±–ª–µ–º—ã
- **–í—Å–µ–≥–æ**: 22 –ø—Ä–æ–±–ª–µ–º—ã

## –í–´–í–û–î–´

–ú–æ–¥—É–ª—å `backtest` —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ**: –ù–∞—Ä—É—à–µ–Ω–∏–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏
3. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –≤—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
4. **Rust-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞**: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —è–∑—ã–∫–∞

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ—ç—Ç–∞–ø–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –Ω–∞—á–∏–Ω–∞—è —Å Critical –∏ High –ø—Ä–æ–±–ª–µ–º.
